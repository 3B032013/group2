{% extends "member/base_member.html" %}

{% block title %}å€‹äººåå¥½è¨­å®š{% endblock %}

{% block content %}

<style>
  /* ===============================
     Preferences Page â€“ UI Upgrade
     =============================== */
  .pref-section { margin-bottom: 36px; }
  .pref-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
  .pref-subtitle { color: #777; font-size: 14px; margin-bottom: 20px; }
  .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
  
  .select-card {
    border: 2px solid #eee;
    border-radius: 16px;
    padding: 18px;
    cursor: pointer;
    transition: all 0.25s ease;
    background: #fff;
    position: relative;
  }
  .select-card:hover { border-color: #ffb48a; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
  .select-card.active { border-color: #ff9f6e; background: #fff5ee; }
  .select-card input { display: none; }
  .select-card .icon { font-size: 28px; margin-bottom: 10px; }
  .select-card .label { font-weight: 700; font-size: 16px; margin-bottom: 4px; }
  .select-card .desc { font-size: 13px; color: #777; }

  .sub-options { margin-top: 20px; padding-left: 12px; border-left: 3px solid #ffe1cf; }
  .sub-title { font-weight: 600; margin-bottom: 12px; }
  .sub-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
  
  .sub-card {
    border: 1.5px solid #eee;
    border-radius: 12px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .sub-card.active { border-color: #ff9f6e; background: #fff7f1; }
  .sub-card input { display: none; }
  .save-bar { margin-top: 40px; }
</style>

<h1 class="mb-2">æ‰“é€ ä½ çš„æ—…éŠåå¥½</h1>
<p class="text-muted mb-4">
  å‘Šè¨´æˆ‘å€‘ä½ å–œæ­¡æ€æ¨£çš„æ—…è¡Œæ–¹å¼ï¼Œç³»çµ±æœƒç‚ºä½ æ¨è–¦æ›´é©åˆçš„å…§å®¹ã€‚
</p>

<form method="post">

  <div class="pref-section">
    <div class="pref-title">ä½ æƒ³æ¢ç´¢å“ªäº›å…§å®¹ï¼Ÿ</div>
    <div class="pref-subtitle">å¯è¤‡é¸ï¼Œä¹‹å¾Œä»å¯éš¨æ™‚èª¿æ•´</div>
    <div class="card-grid">
      <label class="select-card {% if 'attractions' in preferences.get('content_types', []) %}active{% endif %}">
        <input type="checkbox" name="content_types" value="attractions" {% if 'attractions' in preferences.get('content_types', []) %}checked{% endif %}>
        <div class="icon">ğŸ</div>
        <div class="label">æ™¯é»</div>
        <div class="desc">è‡ªç„¶æ™¯è§€ã€æ–‡åŒ–ã€æˆ¶å¤–æ´»å‹•</div>
      </label>
      <label class="select-card {% if 'food' in preferences.get('content_types', []) %}active{% endif %}">
        <input type="checkbox" name="content_types" value="food" {% if 'food' in preferences.get('content_types', []) %}checked{% endif %}>
        <div class="icon">ğŸ½</div>
        <div class="label">ç¾é£Ÿ</div>
        <div class="desc">é¤å»³ã€å¤œå¸‚ã€åœ¨åœ°å°åƒ</div>
      </label>
      <label class="select-card {% if 'accommodation' in preferences.get('content_types', []) %}active{% endif %}">
        <input type="checkbox" name="content_types" value="accommodation" {% if 'accommodation' in preferences.get('content_types', []) %}checked{% endif %}>
        <div class="icon">ğŸ¨</div>
        <div class="label">ä½å®¿</div>
        <div class="desc">é£¯åº—ã€æ°‘å®¿ã€ç‰¹è‰²ä½å®¿</div>
      </label>
    </div>
  </div>

  <div class="pref-section sub-options" id="attraction-options" style="display: none;">
    <div class="sub-title">ä½ æ¯”è¼ƒåå¥½å“ªç¨®é¡å‹çš„æ™¯é»ï¼Ÿ</div>
    <div class="sub-grid">
      {% for key, label, icon in [('scenery','æ™¯è§€','ğŸŒ„'),('culture','æ–‡åŒ–','ğŸ›'),('outdoor','æˆ¶å¤–','ğŸ¥¾')] %}
      <label class="sub-card {% if key in preferences.get('attraction_types', []) %}active{% endif %}">
        <input type="checkbox" name="attraction_types" value="{{ key }}" {% if key in preferences.get('attraction_types', []) %}checked{% endif %}>
        {{ icon }} {{ label }}
      </label>
      {% endfor %}
    </div>
  </div>

    <div class="pref-section sub-options" id="food-options">
    <div class="sub-title">ä½ å–œæ­¡å“ªç¨®æ–™ç†ï¼Ÿ</div>
    <div class="sub-grid">
        {% for key, label, icon in [('chinese','ä¸­å¼/ç«é‹','ğŸ¥˜'),('japanese','æ—¥å¼/ç‡’çƒ¤','ğŸ£'),('western','è¥¿å¼/ç•°åœ‹','ğŸ•'),('cafe','å’–å•¡ç”œé»','ğŸ°'),('local','åœ¨åœ°å°åƒ','ğŸœ')] %}
        <label class="sub-card {% if key in preferences.get('food_types', []) %}active{% endif %}">
        <input type="checkbox" name="food_types" value="{{ key }}"
            {% if key in preferences.get('food_types', []) %}checked{% endif %}>
        {{ icon }} {{ label }}
        </label>
        {% endfor %}
    </div>
  </div>

  <div class="pref-section sub-options" id="accommodation-options" style="display: none;">
    <div class="sub-title">ä½ åå¥½å“ªç¨®ä½å®¿ï¼Ÿ</div>
    <div class="sub-grid">
      {% for key, label, icon in [('hotel','é£¯åº—','ğŸ¨'),('bnb','æ°‘å®¿','ğŸ¡'),('business','å•†æ—…','ğŸ’¼'),('special','ç‰¹è‰²ä½å®¿','âœ¨')] %}
      <label class="sub-card {% if key in preferences.get('accommodation_types', []) %}active{% endif %}">
        <input type="checkbox" name="accommodation_types" value="{{ key }}" {% if key in preferences.get('accommodation_types', []) %}checked{% endif %}>
        {{ icon }} {{ label }}
      </label>
      {% endfor %}
    </div>
  </div>

  <div class="save-bar">
    <button type="submit" class="btn btn-primary btn-lg">å„²å­˜æˆ‘çš„æ—…éŠåå¥½</button>
  </div>
</form>

<script>
  function syncCards() {
    // è™•ç†å¡ç‰‡é»æ“Šå¾Œçš„è¦–è¦ºæ•ˆæœï¼ˆè®Šæ©˜è‰²èƒŒæ™¯ï¼‰
    document.querySelectorAll('.select-card, .sub-card').forEach(card => {
      const input = card.querySelector('input');
      if (input.checked) {
        card.classList.add('active');
      } else {
        card.classList.remove('active');
      }
    });

    // æ ¹æ“šå¤§é¡å‹¾é¸ç‹€æ…‹é¡¯ç¤º/éš±è—ç´°åˆ†é¡
    const showAtt = document.querySelector('input[value="attractions"]').checked;
    const showFood = document.querySelector('input[value="food"]').checked;
    const showAcc = document.querySelector('input[value="accommodation"]').checked;

    document.getElementById('attraction-options').style.display = showAtt ? 'block' : 'none';
    document.getElementById('food-options').style.display = showFood ? 'block' : 'none';
    document.getElementById('accommodation-options').style.display = showAcc ? 'block' : 'none';
  }

  // ç›£è½æ‰€æœ‰ input è®ŠåŒ–
  document.querySelectorAll('input').forEach(i => {
    i.addEventListener('change', syncCards);
  });

  // åˆå§‹åŸ·è¡Œä¸€æ¬¡ï¼Œç¢ºä¿å¾è³‡æ–™åº«è®€å–çš„å‹¾é¸ç‹€æ…‹èƒ½æ­£ç¢ºé¡¯ç¤º
  syncCards();
</script>

{% endblock %}